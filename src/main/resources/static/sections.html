<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subject Sections</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* --- General Theme --- */
    body {
        background-color: #1a1a1a;
        color: #f5f5f5;
        font-family: Arial, sans-serif;
        position: relative;
        padding-top: 70px; /* Space for navbar */
    }

    /* Navbar */
    .navbar {
        background-color: #333 !important;
    }
    .navbar-brand, .nav-link { color: #f5c518 !important; font-weight: bold; }

    /* Headings */
    h1 { color: #f5c518; }

    /* Roadmap */
    .roadmap {
        display: flex;
        align-items: center;
        justify-content: start;
        gap: 30px;
        margin-top: 50px;
        flex-wrap: wrap;
    }
    .roadmap-step {
        text-align: center;
        padding: 15px 20px;
        border-radius: 10px;
        background-color: #262626;
        border: 1px solid #444;
        min-width: 120px;
        position: relative;
        transition: transform 0.2s, background-color 0.2s;
        color: #f5f5f5;
        font-weight: bold;
        cursor: pointer;
    }
    .roadmap-step:hover { transform: scale(1.05); background-color: #333; }
    .roadmap-step.bg-success { background-color: #28a745; color: #fff; }
    .roadmap-step.bg-danger { background-color: #dc3545; color: #fff; }
    .roadmap-step::after {
        content: 'â†’';
        position: absolute;
        right: -25px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 20px;
        color: #f5c518;
    }
    .roadmap-step:last-child::after { content: ''; }

    /* Back button */
    #backBtn {
        position: absolute;
        top: 15px;
        right: 15px;
        z-index: 10;
        background-color: #0d6efd;
        border: none;
        color: #fff;
        font-weight: bold;
    }
    #backBtn:hover { background-color: #0b5ed7; }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">LEARNIFY</a>
    <button id="backBtn" class="btn">Back to Dashboard</button>
  </div>
</nav>

<div class="container text-center">
  <h1 id="subjectTitle" class="mt-4"></h1>
  <div id="roadmap" class="roadmap"></div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', async function () {
      const urlParams = new URLSearchParams(window.location.search);
      const subjectId = urlParams.get('subjectId');
      const subjectName = urlParams.get('subjectName') || 'Unknown Subject';

      const roadmapContainer = document.getElementById('roadmap');
      const subjectTitle = document.getElementById('subjectTitle');
      const backBtn = document.getElementById('backBtn');

      subjectTitle.textContent = `Learning Path: ${subjectName}`;

      backBtn.addEventListener('click', () => {
          window.location.href = 'learnerDashboard.html';
      });

      if (!subjectId) {
          alert('Invalid subject. Please go back and select a subject.');
          window.location.href = 'learnerDashboard.html';
          return;
      }

      // Start step
      const startStep = document.createElement('div');
      startStep.className = 'roadmap-step bg-success';
      startStep.textContent = 'Start';
      roadmapContainer.appendChild(startStep);

      try {
          const response = await fetch(`http://localhost:8081/Sections/SectionsBySubject/${subjectId}`);
          const sections = await response.json();

          if (!Array.isArray(sections) || sections.length === 0) {
              const noSection = document.createElement('div');
              noSection.textContent = 'No sections found for this subject';
              noSection.className = 'text-muted mt-3';
              roadmapContainer.appendChild(noSection);
          } else {
              // Add sections and make clickable
              sections.forEach(sec => {
                  const step = document.createElement('div');
                  step.className = 'roadmap-step';
                  step.textContent = sec.sectionName;
                  step.addEventListener('click', () => {
                      window.location.href = `topics.html?sectionId=${sec.sectionId}&sectionName=${encodeURIComponent(sec.sectionName)}`;
                  });
                  roadmapContainer.appendChild(step);
              });
          }

          // End step
          const endStep = document.createElement('div');
          endStep.className = 'roadmap-step bg-danger';
          endStep.textContent = 'End';
          roadmapContainer.appendChild(endStep);

      } catch (error) {
          console.error('Error fetching sections:', error);
          const errorMsg = document.createElement('div');
          errorMsg.textContent = 'Failed to load sections. Please try again later.';
          errorMsg.className = 'text-danger mt-3';
          roadmapContainer.appendChild(errorMsg);
      }
  });
</script>
</body>
</html>
